{% extends 'layout.html' %}
{% block body %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js" type="text/javascript"></script>
<script>
  var mqtt;
  var reconnectTimeout = 2000;
  var host = "{{ mqtt_broker_host }}";
  var port = {{ mqtt_broker_port }};

  function onConnect(){
    console.log("Connected");
    var message = new Paho.MQTT.Message("Hello World!");
    message.destinationName = "poc/status";
    mqtt.send(message);
  }

  function MQTTconnect(){
    console.log("Connecting to {{ mqtt_broker_host }}:{{ mqtt_bocker_port }}...");
    mqtt = new Paho.MQTT.Client(host, port, "jspoc");
    var options = {
      timeout: 3,
      onSuccess: onConnect,
    };
    mqtt.connect(options);
  }
</script>
<body>
  <script>
    MQTTconnect();
  </script>
</body>
{% endblock %}
